# 本番環境移行前チェックリスト

## 📋 概要
本番環境（Vercel + Fly.io）へのデプロイ前に完了すべきタスクリスト

---

## 🔐 セキュリティ設定

### Google reCAPTCHA v3設定 ⏳
- [ ] **reCAPTCHAキー取得**
  - URL: https://www.google.com/recaptcha/admin
  - タイプ: reCAPTCHA v3
  - ラベル: ToolRadar
  - ドメイン登録:
    - `localhost` (開発環境)
    - `toolradar.jp` (本番ドメイン)
    - `*.vercel.app` (Vercelプレビュー環境)
  
- [ ] **環境変数設定**
  - Vercel（Frontend）: `NEXT_PUBLIC_RECAPTCHA_SITE_KEY`
  - Fly.io（Backend）: `RECAPTCHA_SECRET_KEY`

### Django設定 ⏳
- [ ] **SECRET_KEY変更**
  - 現在: デフォルト開発用キー
  - 対応: ランダムな50文字以上のキー生成
  - コマンド: `python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"`

- [ ] **DEBUG無効化**
  - 本番環境: `DJANGO_DEBUG=False`
  - 確認: エラーページがカスタム404/500表示になること

- [ ] **ALLOWED_HOSTS設定**
  - 本番ドメイン追加: `toolradar.jp,www.toolradar.jp`
  - Fly.ioドメイン追加: `*.fly.dev`

---

## 📧 メール設定

### SMTP設定 ⏳
- [ ] **SMTPサーバー設定**
  - 推奨: SendGrid, AWS SES, Gmail SMTP
  - 環境変数:
    ```
    EMAIL_HOST=smtp.sendgrid.net
    EMAIL_PORT=587
    EMAIL_USE_TLS=True
    EMAIL_HOST_USER=apikey
    EMAIL_HOST_PASSWORD=<SendGrid APIキー>
    ```

- [ ] **送信元アドレス設定**
  - `DEFAULT_FROM_EMAIL=noreply@toolradar.jp`
  - `SERVER_EMAIL=server@toolradar.jp`
  - `ADMIN_EMAIL=admin@toolradar.jp`

- [ ] **DNSレコード設定**
  - SPFレコード: `v=spf1 include:sendgrid.net ~all`
  - DKIMレコード: SendGrid管理画面から取得
  - DMARCレコード: `v=DMARC1; p=quarantine; rua=mailto:dmarc@toolradar.jp`

### メール配信テスト ⏳
- [ ] お問い合わせフォーム送信テスト
- [ ] 管理者通知メール受信確認
- [ ] 迷惑メールフィルタ回避確認

---

## 🗄️ データベース

### PostgreSQL本番設定 ⏳
- [ ] **Fly.io PostgreSQL作成**
  - コマンド: `flyctl postgres create`
  - プラン選択: 要件に応じて
  - バックアップ設定確認

- [ ] **マイグレーション実行**
  ```bash
  flyctl ssh console
  python manage.py migrate
  python manage.py createsuperuser
  ```

- [ ] **初期データ投入**
  - ContactPage作成（Wagtail管理画面）
  - サンプルツールデータ（必要に応じて）

### Redis設定 ⏳
- [ ] **Fly.io Redis作成** または **Upstash Redis利用**
- [ ] キャッシュ動作確認

---

## 🖼️ 静的ファイル・メディア

### AWS S3設定 ⏳
- [ ] **S3バケット作成**
  - バケット名: `toolradar-static`, `toolradar-media`
  - リージョン: `ap-northeast-1` (東京)
  - パブリックアクセス設定

- [ ] **IAMユーザー作成**
  - ポリシー: S3フルアクセス
  - アクセスキー取得: `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`

- [ ] **Django設定**
  ```python
  # settings.py
  STATICFILES_STORAGE = 'storages.backends.s3boto3.S3Boto3Storage'
  DEFAULT_FILE_STORAGE = 'storages.backends.s3boto3.S3Boto3Storage'
  AWS_S3_CUSTOM_DOMAIN = 'toolradar-static.s3.amazonaws.com'
  ```

- [ ] **静的ファイル収集**
  ```bash
  python manage.py collectstatic --noinput
  ```

---

## 🔍 SEO・アナリティクス

### Google設定 ⏳
- [ ] **Google Search Console登録**
  - サイトマップ送信: `https://toolradar.jp/sitemap.xml`
  - 所有権確認

- [ ] **Google Analytics 4設定**
  - プロパティ作成
  - 測定ID取得: `G-XXXXXXXXXX`
  - 環境変数: `NEXT_PUBLIC_GA_ID`

- [ ] **Google AdSense審査申請**
  - 必要記事数: 10記事以上推奨
  - `NEXT_PUBLIC_ADSENSE_CLIENT_ID` 設定

### robots.txt・sitemap.xml ⏳
- [ ] `robots.txt` 本番設定確認
- [ ] `sitemap.xml` 自動生成確認
- [ ] 全ページのクロール可否確認

---

## 🚀 デプロイ設定

### Vercel（Frontend） ⏳
- [ ] **プロジェクト作成**
  - GitHub連携
  - ルートディレクトリ: `frontend`
  - フレームワーク: Next.js
  - Node.js バージョン: 20.x

- [ ] **環境変数設定**
  ```
  NEXT_PUBLIC_API_URL=https://toolradar-backend.fly.dev
  NEXT_PUBLIC_SITE_URL=https://toolradar.jp
  NEXT_PUBLIC_RECAPTCHA_SITE_KEY=<Site Key>
  NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX
  NEXT_PUBLIC_ADSENSE_CLIENT_ID=ca-pub-xxxxxxxxxx
  ```

- [ ] **カスタムドメイン設定**
  - `toolradar.jp` → Vercel
  - `www.toolradar.jp` → toolradar.jp（リダイレクト）

### Fly.io（Backend） ⏳
- [ ] **アプリケーション作成**
  ```bash
  flyctl launch
  flyctl deploy
  ```

- [ ] **環境変数設定**
  ```bash
  flyctl secrets set DJANGO_SECRET_KEY=<ランダムキー>
  flyctl secrets set DJANGO_DEBUG=False
  flyctl secrets set RECAPTCHA_SECRET_KEY=<Secret Key>
  flyctl secrets set EMAIL_HOST_PASSWORD=<SMTPパスワード>
  flyctl secrets set AWS_ACCESS_KEY_ID=<AWSキー>
  flyctl secrets set AWS_SECRET_ACCESS_KEY=<AWSシークレット>
  ```

- [ ] **ヘルスチェック設定**
- [ ] **スケーリング設定**（必要に応じて）

---

## 🧪 テスト

### 機能テスト ⏳
- [ ] **お問い合わせフォーム**
  - バリデーション動作確認
  - reCAPTCHA検証確認
  - メール送信確認
  
- [ ] **ブログ記事**
  - プレビュー機能
  - 公開・非公開切り替え
  - StreamField全ブロック表示確認

- [ ] **ツール一覧・詳細**
  - 検索・フィルタリング
  - 週間ランキング表示
  - ASP広告表示

### パフォーマンステスト ⏳
- [ ] **Lighthouse スコア確認**
  - Performance: 90以上
  - Accessibility: 90以上
  - Best Practices: 90以上
  - SEO: 90以上

- [ ] **レスポンス時間**
  - トップページ: 2秒以内
  - API: 500ms以内

### セキュリティテスト ⏳
- [ ] **HTTPS強制**
- [ ] **CSRFトークン動作確認**
- [ ] **XSS対策確認**
- [ ] **SQL Injection対策確認**

---

## 📊 監視・ログ

### エラー監視 ⏳
- [ ] **Sentry導入**
  - プロジェクト作成: Backend, Frontend
  - DSN設定
  - エラー通知先設定

### ログ設定 ⏳
- [ ] **Fly.io ログ確認**
  ```bash
  flyctl logs
  ```
  
- [ ] **Vercel ログ確認**
  - ダッシュボードでログ閲覧

---

## 📝 ドキュメント

### 運用ドキュメント ⏳
- [ ] デプロイ手順書
- [ ] 緊急対応手順書
- [ ] バックアップ・復旧手順書
- [ ] 問い合わせ対応フロー

### 開発ドキュメント ⏳
- [ ] API仕様書（Swagger）
- [ ] データモデル図
- [ ] 環境変数一覧

---

## ✅ 最終確認

### リリース前チェック ⏳
- [ ] 全機能の動作確認（本番環境）
- [ ] モバイル表示確認
- [ ] 主要ブラウザ確認（Chrome, Safari, Firefox, Edge）
- [ ] 404/500エラーページ表示確認
- [ ] OGP画像・メタタグ確認
- [ ] Google Search Console インデックス確認

### バックアップ ⏳
- [ ] データベースバックアップ設定
- [ ] メディアファイルバックアップ設定
- [ ] 復旧テスト実施

---

## 📅 推奨スケジュール

```
Week 1: セキュリティ設定、メール設定
Week 2: データベース、静的ファイル設定
Week 3: デプロイ設定、テスト
Week 4: 監視・ログ、最終確認
Week 5: リリース
```

---

## 🔗 参考リンク

- [Vercel デプロイドキュメント](https://vercel.com/docs)
- [Fly.io デプロイガイド](https://fly.io/docs/)
- [Django デプロイチェックリスト](https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/)
- [Next.js プロダクションチェックリスト](https://nextjs.org/docs/going-to-production)
- [Google reCAPTCHA Admin](https://www.google.com/recaptcha/admin)
- [SendGrid ドキュメント](https://docs.sendgrid.com/)

---

**最終更新:** 2025-11-28  
**ステータス:** Phase 2 完了後、本番移行準備開始

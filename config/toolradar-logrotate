# ToolRadar - ログローテーション設定
#
# このファイルは /etc/logrotate.d/ に配置します
#
# インストール方法:
#   sudo cp toolradar-logrotate /etc/logrotate.d/toolradar
#   sudo chmod 644 /etc/logrotate.d/toolradar
#
# 手動実行（テスト用）:
#   sudo logrotate -f /etc/logrotate.d/toolradar
#   sudo logrotate -d /etc/logrotate.d/toolradar  # ドライラン

/var/log/toolradar/cleanup.log {
    # 週次でローテーション
    weekly
    
    # 過去4週間分を保持
    rotate 4
    
    # ローテーション後に圧縮
    compress
    
    # 最新のログファイルは圧縮しない
    delaycompress
    
    # ログファイルがなくてもエラーを出さない
    missingok
    
    # 空のログファイルはローテーションしない
    notifempty
    
    # ローテーション後のファイル名に日付を付ける
    dateext
    dateformat -%Y%m%d
    
    # ファイルの権限設定
    create 0644 root root
    
    # ローテーション後にサービスをリロード（必要に応じて）
    # postrotate
    #     systemctl reload toolradar-backend
    # endscript
}

# Django アプリケーションログ
/var/log/toolradar/django.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    dateext
    create 0644 root root
}

# Nginx アクセスログ（本番環境用）
/var/log/toolradar/nginx-access.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    dateext
    create 0644 www-data www-data
    sharedscripts
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`
    endscript
}

# Nginx エラーログ（本番環境用）
/var/log/toolradar/nginx-error.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    dateext
    create 0644 www-data www-data
    sharedscripts
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`
    endscript
}

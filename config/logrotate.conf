# ToolRadar - ログローテーション設定
# /etc/logrotate.d/toolradar に配置

/var/log/toolradar/cleanup.log {
    # 週次でローテーション
    weekly
    
    # 4世代保持（約1ヶ月分）
    rotate 4
    
    # 圧縮して保存
    compress
    delaycompress
    
    # ファイルが存在しなくてもエラーにしない
    missingok
    
    # 空のログファイルはローテーションしない
    notifempty
    
    # ローテーション後の権限設定
    create 0644 root root
    
    # ローテーション後にサービス再起動は不要
    # （Dockerログなのでsignal不要）
}

/var/log/toolradar/django.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
}

/var/log/toolradar/nginx-access.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}

/var/log/toolradar/nginx-error.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}
